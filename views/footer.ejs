</main>

<footer class="footer">
    <div class="container footer__inner">
        <div class="footer__brand">
            <span class="logo__icon">⚡</span>
            <span class="logo__text">Server<span class="logo__accent">Place</span></span>
            <p class="footer__desc">Маркетплейс сравнения облачных серверов в РФ</p>
        </div>
        <div class="footer__links">
            <div class="footer__col">
                <h4>Навигация</h4>
                <a href="/servers">Подобрать сервер</a>
                <a href="/providers">Провайдеры</a>
                <a href="/compare">Сравнение</a>
            </div>
            <div class="footer__col">
                <h4>Информация</h4>
                <a href="/reviews">Отзывы</a>
                <a href="/blog">Блог</a>
                <a href="/faq">FAQ</a>
                <a href="/contacts">Контакты</a>
                <a href="/privacy">Политика конфиденциальности</a>
            </div>
        </div>
        <div class="footer__bottom">
            <p>&copy; 2026 ServerPlace. Все права защищены.</p>
        </div>
    </div>
</footer>

<!-- Lead modal -->
<div class="modal" id="leadModal">
    <div class="modal__overlay" onclick="closeLeadModal()"></div>
    <div class="modal__content">
        <button class="modal__close" onclick="closeLeadModal()">&times;</button>
        <div id="leadStep1" class="modal__step">
            <h3>Заказать сервер</h3>
            <p class="modal__provider" id="modalProviderName"></p>
            <p class="modal__offer" id="modalOfferName"></p>
            <p class="modal__price" id="modalPrice"></p>
            <div class="form-group">
                <label for="leadEmail">Email</label>
                <input type="email" id="leadEmail" class="input" placeholder="your@email.com" required>
                <span class="form-error" id="emailError"></span>
            </div>
            <input type="text" name="honeypot" id="leadHoneypot" style="display:none" tabindex="-1" autocomplete="off">
            <button class="btn btn--primary btn--full" onclick="leadNextStep()">Продолжить</button>
        </div>
        <div id="leadStep2" class="modal__step" style="display:none">
            <h3>Почти готово!</h3>
            <div class="form-group">
                <label for="leadPhone">Телефон</label>
                <input type="tel" id="leadPhone" class="input" placeholder="+7 (___) ___-__-__" required>
                <span class="form-error" id="phoneError"></span>
            </div>
            <div class="form-group" style="margin-top: 1rem; text-align: left;">
                <label
                    style="display: flex; align-items: flex-start; gap: 8px; font-size: 0.8rem; font-weight: normal; cursor: pointer; text-transform: none; line-height: 1.3;">
                    <input type="checkbox" id="leadPrivacyAgree" checked style="margin-top: 2px;">
                    <span style="color: var(--text-dim);">Нажимая кнопку, я принимаю <a href="/privacy" target="_blank"
                            style="text-decoration: underline; color: var(--primary);">политику конфиденциальности</a> и
                        даю согласие на обработку персональных данных.</span>
                </label>
            </div>
            <button class="btn btn--primary btn--full" onclick="submitLead()">Заказать</button>
            <button class="btn btn--ghost" onclick="leadPrevStep()" style="margin-top:8px">&#8592; Назад</button>
        </div>
        <div id="leadSuccess" class="modal__step" style="display:none">
            <div class="modal__success-icon">&#10003;</div>
            <h3>Заявка отправлена!</h3>
            <p>Ожидайте — провайдер с вами свяжется.</p>
            <button class="btn btn--primary" onclick="closeLeadModal()">Вернуться к подбору</button>
        </div>
    </div>
</div>

<script>
    document.getElementById('navToggle').addEventListener('click', function () {
        document.getElementById('mainNav').classList.toggle('nav--open');
        this.classList.toggle('nav-toggle--active');
    });
    var _leadData = {};
    function openLeadModal(providerId, offerId, providerName, offerName, price) {
        _leadData = { provider_id: providerId, offer_id: offerId };
        document.getElementById('modalProviderName').textContent = providerName || '';
        document.getElementById('modalOfferName').textContent = offerName || '';
        document.getElementById('modalPrice').textContent = price ? price + ' \u20BD/\u043C\u0435\u0441' : '';
        document.getElementById('leadStep1').style.display = 'block';
        document.getElementById('leadStep2').style.display = 'none';
        document.getElementById('leadSuccess').style.display = 'none';
        document.getElementById('leadEmail').value = '';
        document.getElementById('leadPhone').value = '';
        document.getElementById('leadModal').classList.add('modal--active');
        document.body.style.overflow = 'hidden';
    }
    function closeLeadModal() {
        document.getElementById('leadModal').classList.remove('modal--active');
        document.body.style.overflow = '';
    }
    function leadNextStep() {
        var email = document.getElementById('leadEmail').value.trim();
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            document.getElementById('emailError').textContent = '\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 email';
            return;
        }
        document.getElementById('emailError').textContent = '';
        document.getElementById('leadStep1').style.display = 'none';
        document.getElementById('leadStep2').style.display = 'block';
    }
    function leadPrevStep() {
        document.getElementById('leadStep2').style.display = 'none';
        document.getElementById('leadStep1').style.display = 'block';
    }
    function submitLead() {
        var phone = document.getElementById('leadPhone').value.trim();
        if (phone.length < 5) {
            document.getElementById('phoneError').textContent = '\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430';
            return;
        }
        if (!document.getElementById('leadPrivacyAgree').checked) {
            document.getElementById('phoneError').textContent = 'Необходимо согласие на обработку данных';
            return;
        }
        document.getElementById('phoneError').textContent = '';
        var body = Object.assign({}, _leadData, {
            email: document.getElementById('leadEmail').value.trim(),
            phone: phone,
            honeypot: document.getElementById('leadHoneypot').value,
            page_url: window.location.href,
            referrer: document.referrer
        });
        fetch('/api/leads', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        }).then(function (r) { return r.json(); }).then(function (data) {
            if (data.success) {
                if (typeof ym === 'function') { ym(106945189, 'reachGoal', 'lead'); }
                document.getElementById('leadStep2').style.display = 'none';
                document.getElementById('leadSuccess').style.display = 'block';
            } else {
                document.getElementById('phoneError').textContent = data.error || '\u041E\u0448\u0438\u0431\u043A\u0430';
            }
        }).catch(function () {
            document.getElementById('phoneError').textContent = '\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0442\u0438';
        });
    }
    document.getElementById('leadPhone').addEventListener('input', function () {
        var v = this.value.replace(/\D/g, '');
        if (v.charAt(0) === '8') v = '7' + v.substring(1);
        if (v.charAt(0) !== '7') v = '7' + v;
        var f = '+7';
        if (v.length > 1) f += ' (' + v.substring(1, 4);
        if (v.length > 4) f += ') ' + v.substring(4, 7);
        if (v.length > 7) f += '-' + v.substring(7, 9);
        if (v.length > 9) f += '-' + v.substring(9, 11);
        this.value = f;
    });
</script>

<!-- Cookie Banner -->
<div id="cookieBanner" class="cookie-banner" style="display: none;">
    <div class="cookie-banner__content">
        <p>Мы используем Cookie для улучшения подбора серверов. Пожалуйста, дайте доступ.</p>
        <div class="cookie-banner__actions">
            <button class="btn btn--primary btn--sm" onclick="acceptCookies('all')">Все cookie</button>
            <button class="btn btn--secondary btn--sm" onclick="acceptCookies('essential')">Только необходимые</button>
            <button class="btn btn--ghost btn--sm" style="color: var(--text-muted);"
                onclick="acceptCookies('none')">Запретить</button>
        </div>
    </div>
</div>

<script>
    (function () {
        if (!localStorage.getItem('sp_cookie_consent')) {
            document.getElementById('cookieBanner').style.display = 'block';
        }
    })();

    function acceptCookies(type) {
        localStorage.setItem('sp_cookie_consent', type);
        document.getElementById('cookieBanner').style.display = 'none';
        if (type === 'all' && typeof ym === 'function') {
            // Разрешили всё - переподключаем метрику если нужно
        }
    }
</script>

</body>

</html>